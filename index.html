<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Truck & Driver Scheduler</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background-color: #0f0f0f;
      color: #e0e0e0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    h2, h3 {
      color: #ffffff;
      text-align: center;
      margin: 20px 0 10px;
    }

    .calendar-controls {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 15px 30px;
      background-color: #1c1c1c;
      border-bottom: 1px solid #333;
      flex-wrap: wrap;
      gap: 10px;
    }

    .calendar-controls button {
      background-color: #333;
      color: #fff;
      border: 1px solid #444;
      border-radius: 5px;
      padding: 8px 16px;
      cursor: pointer;
      transition: background 0.2s ease;
    }

    .calendar-controls button:hover {
      background-color: #444;
    }

    .calendar-container-wrapper {
      position: relative;
      max-width: 1350px;
      margin: 0 auto;
    }

    .calendar-container {
      display: grid;
      grid-template-columns: 1fr repeat(7, 1fr);
      width: 100%;
      border: 1px solid #333;
    }

    .column {
      background: #1a1a1a;
      padding: 10px;
      text-align: center;
      border: 1px solid #292929;
    }

    .column:hover {
      background: #222;
    }

    .fixed {
      position: sticky;
      left: 0;
      background: #202020;
      font-weight: bold;
      z-index: 2;
    }

    .truck-cell {
      height: 70px;
      position: relative;
      cursor: pointer;
      transition: background 0.15s ease;
    }

    .truck-cell:hover {
      background: #2a2a2a;
    }

    .entry-box {
      padding: 5px;
      border-radius: 5px;
      font-size: 13px;
      color: #fff;
      position: relative;
      height: 100%;
    }

    .entry-controls {
      display: none;
      position: absolute;
      bottom: 3px;
      right: 5px;
    }

    .entry-box:hover .entry-controls {
      display: block;
    }

    .week-nav-button {
      position: absolute;
      top: 40%;
      transform: translateY(-50%);
      background: #333;
      border: 1px solid #444;
      color: white;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      font-size: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 10;
      transition: background 0.2s ease;
    }

    .week-nav-button:hover {
      background: #555;
    }

    #prevWeekBtn {
      left: -60px;
    }

    #nextWeekBtn {
      right: -60px;
    }

    .driver-list {
     display: grid;
     grid-template-columns: repeat(4, auto);
     gap: 15px 30px;
     padding: 20px;
     background: #1a1a1a;
     border-top: 1px solid #333;
     justify-content: center;
     position: relative;
    }

    .driver {
     background: #2d2d2d;
     padding: 8px 14px;
     border-radius: 8px;
     border: 2px solid #555;
     font-size: 14px;
     text-align: center;
     white-space: nowrap;

     display: flex;
     align-items: center;
     justify-content: center;
     height: 40px; 
    }


    .driver-status-available {
      border-color: #00c853;
    }

    .driver-status-driving {
      border-color: #ffd600;
    }

    .driver-status-break {
      border-color: #d50000;
    }

    .overlay-form,
    .driver-edit-form {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: #1e1e1e;
      padding: 20px;
      border-radius: 10px;
      border: 1px solid #555;
      width: 300px;
      z-index: 100;
      display: none;
      box-shadow: 0 0 10px rgba(0,0,0,0.7);
    }

    .overlay-form label,
    .driver-edit-form label {
      display: block;
      margin-bottom: 5px;
      color: #ccc;
    }

    .overlay-form select,
    .overlay-form input,
    .driver-edit-form select {
      width: 100%;
      margin-bottom: 12px;
      padding: 8px;
      background: #292929;
      color: #fff;
      border: 1px solid #555;
      border-radius: 5px;
    }

    .overlay-form-buttons,
    .driver-edit-form-buttons {
      display: flex;
      justify-content: space-between;
    }

    .overlay-form-buttons button,
    .driver-edit-form button,
    #driver-edit-button {
      width: 48%;
      padding: 8px;
      background: #333;
      color: white;
      border: 1px solid #444;
      border-radius: 5px;
      cursor: pointer;
      transition: background 0.2s ease;
    }

    .overlay-form-buttons button:hover,
    .driver-edit-form button:hover,
    #driver-edit-button:hover {
      background: #444;
    }

    #driver-edit-button {
      position: absolute;
      left: 10px;
      top: 10px;
      font-size: 13px;
      padding: 5px 10px;
      background: #333;
      color: white;
      border: 1px solid #444;
      border-radius: 4px;
      cursor: pointer;
      width: auto;
      height: auto;
      z-index: 5;
    }

    #driver-edit-button:hover {
      background: #444;
    }

    #clearWeekBtn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #444;
      color: white;
      border: 1px solid #666;
      border-radius: 50%;
      width: 48px;
      height: 48px;
      font-size: 22px;
      cursor: pointer;
      z-index: 50;
      box-shadow: 0 2px 10px rgba(0,0,0,0.4);
      transition: background 0.2s ease;
    }

    #clearWeekBtn:hover {
      background: #555;
    }
    
    #downloadReportBtn {
    position: fixed;
    bottom: 80px;
    right: 20px;
    background: #444;
    color: white;
    border: 1px solid #666;
    border-radius: 50%;
    width: 48px;
    height: 48px;
    font-size: 20px;
    cursor: pointer;
    z-index: 50;
    box-shadow: 0 2px 10px rgba(0,0,0,0.4);
    transition: background 0.2s ease;
}

#downloadReportBtn:hover {
  background: #0099ff;
}
    .country-–ê–≤—Å—Ç—Ä–∏—è {background: #920000; }
    .country-–ë–µ–ª–≥–∏—è {background: #0037a5; }
    .country-–ë—ä–ª–≥–∞—Ä–∏—è {background: #017e0b; }
    .country-–•—ä—Ä–≤–∞—Ç–∏—è {background: #ff1212; }
    .country-–ß–µ—Ö–∏—è {background: #983eff; }
    .country-–î–∞–Ω–∏—è {background: #07a6e6; }
    .country-–ï—Å—Ç–æ–Ω–∏—è {background: #d35ccd; }
    .country-–§–∏–Ω–ª–∞–Ω–¥–∏—è {background: #5f008b; }
    .country-–§—Ä–∞–Ω—Ü–∏—è {background: #00b46f; }
    .country-–ì–µ—Ä–º–∞–Ω–∏—è {background: #798605; }
    .country-–ì—ä—Ä—Ü–∏—è {background: #d3e910; }
    .country-–£–Ω–≥–∞—Ä–∏—è {background: #cc6504; }
    .country-–ò—Ç–∞–ª–∏—è {background: #5cfc00; }
    .country-–õ–∞—Ç–≤–∏—è {background: #c23d74; }
    .country-–õ–∏—Ç–≤–∞ {background: #86005a; }
    .country-–ù–∏–¥–µ—Ä–ª–∞–Ω–¥–∏—è {background: #ff0000; }
    .country-–ù–æ—Ä–≤–µ–≥–∏—è {background: #f08001; }
    .country-–ü–æ–ª—à–∞ {background: #437700; }
    .country-–ü–æ—Ä—Ç—É–≥–∞–ª–∏—è {background: #01c087; }
    .country-–†—É–º—ä–Ω–∏—è {background: #000283; }
    .country-–°–ª–æ–≤–∞–∫–∏—è {background: #970053; }
    .country-–°–ª–æ–≤–µ–Ω–∏—è {background: #e97f4e; }
    .country-–ò—Å–ø–∞–Ω–∏—è {background: #ddec0a; }
    .country-–®–≤–µ—Ü–∏—è {background: #61b314; }
    .country-–®–≤–µ–π—Ü–∞—Ä–∏—è {background: #148a45; }
    .country-–¢—É—Ä—Ü–∏—è {background: #8a1515; }
   
  </style>
</head>
<body>

  <div class="calendar-controls">
    <h2 id="week-title">KarmelaTrans –ì—Ä–∞—Ñ–∏–∫</h2>
  </div>

  <div class="calendar-container-wrapper">
    <div id="prevWeekBtn" class="week-nav-button" onclick="prevWeek()">‚óÄ</div>

    <div class="calendar-container" id="calendar">
      <div class="column fixed">–ö–∞–º–∏–æ–Ω–∏</div>
      <div class="column" id="day1"></div>
      <div class="column" id="day2"></div>
      <div class="column" id="day3"></div>
      <div class="column" id="day4"></div>
      <div class="column" id="day5"></div>
      <div class="column" id="day6"></div>
      <div class="column" id="day7"></div>

      <div class="column fixed truck-cell">BT0743MB</div>
      <div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div>

      <div class="column fixed truck-cell">BT0744MB</div>
      <div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div>

      <div class="column fixed truck-cell">BT0746MB</div>
      <div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div>
    
      <div class="column fixed truck-cell">BT0747MB</div>
      <div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div>

      <div class="column fixed truck-cell">BT0748MB</div>
      <div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div>

      <div class="column fixed truck-cell">BT0750MB</div>
      <div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div>
    
      <div class="column fixed truck-cell">BT0751MB</div>
      <div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div>
    
      <div class="column fixed truck-cell">BT0752MB</div>
      <div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div>
   
      <div class="column fixed truck-cell">BT0753MB</div>
      <div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div>
   
      <div class="column fixed truck-cell">BT0754MB</div>
      <div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div>
    
      <div class="column fixed truck-cell">–í–¢1057–ú–ï</div>
      <div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div>
    
      <div class="column fixed truck-cell">–í–¢1059–ú–ï</div>
      <div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div>

      <div class="column fixed truck-cell">–í–¢1091–ú–ï</div>
      <div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div>

      <div class="column fixed truck-cell">–í–¢1092–ú–ï</div>
      <div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div>

      <div class="column fixed truck-cell">–í–¢1093–ú–ï</div>
      <div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div><div class="column truck-cell" onclick="openOverlay(this)"></div>
    </div>

    <div id="nextWeekBtn" class="week-nav-button" onclick="nextWeek()">‚ñ∂</div>
  </div>

  <h3 style="text-align: center; margin-top: 20px;">–í–æ–¥–∞—á–∏</h3>
  <div class="driver-list">
    <button id="driver-edit-button" onclick="openDriverEditor()">‚úèÔ∏è Edit</button>
    <div class="driver" id="–ê–Ω—Ç–æ–Ω –ê–Ω–∫–æ–≤">–ê–Ω—Ç–æ–Ω –ê–Ω–∫–æ–≤</div>
    <div class="driver" id="–ë–æ–π–∫–æ –ë–æ—è–Ω–æ–≤">–ë–æ–π–∫–æ –ë–æ—è–Ω–æ–≤</div>
    <div class="driver" id="–ë–æ—è–Ω –ê–Ω–≥–µ–ª–æ–≤">–ë–æ—è–Ω –ê–Ω–≥–µ–ª–æ–≤</div>
    <div class="driver" id="–ï–º–∏–ª–∏—è–Ω –ú–∏—Ö–∞–π–ª–æ–≤">–ï–º–∏–ª–∏—è–Ω –ú–∏—Ö–∞–π–ª–æ–≤</div>
    <div class="driver" id="–ò–≤–∞–π–ª–æ –†–∞–¥–æ–µ–≤">–ò–≤–∞–π–ª–æ –†–∞–¥–æ–µ–≤</div>
    <div class="driver" id="–ò–≤–∞–Ω –ì–µ–æ—Ä–≥–∏–µ–≤">–ò–≤–∞–Ω –ì–µ–æ—Ä–≥–∏–µ–≤</div>
    <div class="driver" id="–ò–≤–æ –ö–∏—Ä–∏–ª–æ–≤">–ò–≤–æ –ö–∏—Ä–∏–ª–æ–≤</div>
    <div class="driver" id="–ò–ª–∏—è–Ω –ú–∏—Ö–∞–π–ª–æ–≤">–ò–ª–∏—è–Ω –ú–∏—Ö–∞–π–ª–æ–≤</div>
    <div class="driver" id="–ö—Ä–∞—Å–∏–º–∏—Ä –ö–æ—Å—Ç–∞–¥–∏–Ω–æ–≤">–ö—Ä–∞—Å–∏–º–∏—Ä –ö–æ—Å—Ç–∞–¥–∏–Ω–æ–≤</div>
    <div class="driver" id="–ù–∏–∫–æ–ª–∞–π –ö—Ä–µ–º–µ–Ω—Å–∫–∏">–ù–∏–∫–æ–ª–∞–π –ö—Ä–µ–º–µ–Ω—Å–∫–∏</div>
    <div class="driver" id="–ü–µ—Ç—ä—Ä –•—Ä–∏—Å—Ç–æ–≤">–ü–µ—Ç—ä—Ä –•—Ä–∏—Å—Ç–æ–≤</div>
    <div class="driver" id="–ü–ª–∞–º–µ–Ω –ò–≤–∞–Ω–æ–≤">–ü–ª–∞–º–µ–Ω –ò–≤–∞–Ω–æ–≤</div>
    <div class="driver" id="–¢–∏—Ö–æ–º–∏—Ä –¢–æ–¥–æ—Ä–æ–≤">–¢–∏—Ö–æ–º–∏—Ä –¢–æ–¥–æ—Ä–æ–≤</div>
    <div class="driver" id="–¢–æ–Ω–∏ –î–µ–Ω–µ–≤">–¢–æ–Ω–∏ –î–µ–Ω–µ–≤</div>
    <div class="driver" id="–¶–≤–µ—Ç–æ–º–∏—Ä –ò–≤–∞–Ω–æ–≤">–¶–≤–µ—Ç–æ–º–∏—Ä –ò–≤–∞–Ω–æ–≤</div>
    <div class="driver" id="–¶–≤–µ—Ç–æ–º–∏—Ä –¶–æ–Ω–µ–≤">–¶–≤–µ—Ç–æ–º–∏—Ä –¶–æ–Ω–µ–≤</div>
  </div>

  <div class="driver-edit-form" id="driverEditor">
    <label for="driverSelectEdit">–ò–∑–±–µ—Ä–µ—Ç–µ –≤–æ–¥–∞—á:</label>
    <select id="driverSelectEdit">
      <option value="–ê–Ω—Ç–æ–Ω –ê–Ω–∫–æ–≤">–ê–Ω—Ç–æ–Ω –ê–Ω–∫–æ–≤</option>
      <option value="–ë–æ–π–∫–æ –ë–æ—è–Ω–æ–≤">–ë–æ–π–∫–æ –ë–æ—è–Ω–æ–≤</option>
      <option value="–ë–æ—è–Ω –ê–Ω–≥–µ–ª–æ–≤">–ë–æ—è–Ω –ê–Ω–≥–µ–ª–æ–≤</option>
      <option value="–ï–º–∏–ª–∏—è–Ω –ú–∏—Ö–∞–π–ª–æ–≤">–ï–º–∏–ª–∏—è–Ω –ú–∏—Ö–∞–π–ª–æ–≤</option>
      <option value="–ò–≤–∞–π–ª–æ –†–∞–¥–æ–µ–≤">–ò–≤–∞–π–ª–æ –†–∞–¥–æ–µ–≤</option>
      <option value="–ò–≤–∞–Ω –ì–µ–æ—Ä–≥–∏–µ–≤">–ò–≤–∞–Ω –ì–µ–æ—Ä–≥–∏–µ–≤</option>
      <option value="–ò–≤–æ –ö–∏—Ä–∏–ª–æ–≤">–ò–≤–æ –ö–∏—Ä–∏–ª–æ–≤</option>
      <option value="–ò–ª–∏—è–Ω –ú–∏—Ö–∞–π–ª–æ–≤">–ò–ª–∏—è–Ω –ú–∏—Ö–∞–π–ª–æ–≤</option>
      <option value="–ö—Ä–∞—Å–∏–º–∏—Ä –ö–æ—Å—Ç–∞–¥–∏–Ω–æ–≤">–ö—Ä–∞—Å–∏–º–∏—Ä –ö–æ—Å—Ç–∞–¥–∏–Ω–æ–≤</option>
      <option value="–ù–∏–∫–æ–ª–∞–π –ö—Ä–µ–º–µ–Ω—Å–∫–∏">–ù–∏–∫–æ–ª–∞–π –ö—Ä–µ–º–µ–Ω—Å–∫–∏</option>
      <option value="–ü–µ—Ç—ä—Ä –•—Ä–∏—Å—Ç–æ–≤">–ü–µ—Ç—ä—Ä –•—Ä–∏—Å—Ç–æ–≤</option>
      <option value="–ü–ª–∞–º–µ–Ω –ò–≤–∞–Ω–æ–≤">–ü–ª–∞–º–µ–Ω –ò–≤–∞–Ω–æ–≤</option>
      <option value="–¢–∏—Ö–æ–º–∏—Ä –¢–æ–¥–æ—Ä–æ–≤">–¢–∏—Ö–æ–º–∏—Ä –¢–æ–¥–æ—Ä–æ–≤</option>
      <option value="–¢–æ–Ω–∏ –î–µ–Ω–µ–≤">–¢–æ–Ω–∏ –î–µ–Ω–µ–≤</option>
      <option value="–¶–≤–µ—Ç–æ–º–∏—Ä –ò–≤–∞–Ω–æ–≤">–¶–≤–µ—Ç–æ–º–∏—Ä –ò–≤–∞–Ω–æ–≤</option>
      <option value="–¶–≤–µ—Ç–æ–º–∏—Ä –¶–æ–Ω–µ–≤">–¶–≤–µ—Ç–æ–º–∏—Ä –¶–æ–Ω–µ–≤</option>

    </select>
    <label for="driverStatusSelect">–°—Ç–∞—Ç—É—Å:</label>
    <select id="driverStatusSelect">
      <option value="available">–ù–∞ —Ä–∞–∑–ø–æ–ª–æ–∂–µ–Ω–∏–µ</option>
      <option value="driving">–®–æ—Ñ–∏—Ä–∞</option>
      <option value="break">–ü—Ä–∞–≤–∏ –ø–∞—É–∑–∞</option>
    </select>
    <button onclick="saveDriverStatus()">Save</button>
    <button onclick="closeDriverEditor()">Cancel</button>
  </div>

  <div class="overlay-form" id="infoForm">
    <label>–í–æ–¥–∞—á:
      <select id="driverSelect">
        <option value="–ê–Ω—Ç–æ–Ω –ê–Ω–∫–æ–≤">–ê–Ω—Ç–æ–Ω –ê–Ω–∫–æ–≤</option>
      <option value="–ë–æ–π–∫–æ –ë–æ—è–Ω–æ–≤">–ë–æ–π–∫–æ –ë–æ—è–Ω–æ–≤</option>
      <option value="–ë–æ—è–Ω –ê–Ω–≥–µ–ª–æ–≤">–ë–æ—è–Ω –ê–Ω–≥–µ–ª–æ–≤</option>
      <option value="–ï–º–∏–ª–∏—è–Ω –ú–∏—Ö–∞–π–ª–æ–≤">–ï–º–∏–ª–∏—è–Ω –ú–∏—Ö–∞–π–ª–æ–≤</option>
      <option value="–ò–≤–∞–π–ª–æ –†–∞–¥–æ–µ–≤">–ò–≤–∞–π–ª–æ –†–∞–¥–æ–µ–≤</option>
      <option value="–ò–≤–∞–Ω –ì–µ–æ—Ä–≥–∏–µ–≤">–ò–≤–∞–Ω –ì–µ–æ—Ä–≥–∏–µ–≤</option>
      <option value="–ò–≤–æ –ö–∏—Ä–∏–ª–æ–≤">–ò–≤–æ –ö–∏—Ä–∏–ª–æ–≤</option>
      <option value="–ò–ª–∏—è–Ω –ú–∏—Ö–∞–π–ª–æ–≤">–ò–ª–∏—è–Ω –ú–∏—Ö–∞–π–ª–æ–≤</option>
      <option value="–ö—Ä–∞—Å–∏–º–∏—Ä –ö–æ—Å—Ç–∞–¥–∏–Ω–æ–≤">–ö—Ä–∞—Å–∏–º–∏—Ä –ö–æ—Å—Ç–∞–¥–∏–Ω–æ–≤</option>
      <option value="–ù–∏–∫–æ–ª–∞–π –ö—Ä–µ–º–µ–Ω—Å–∫–∏">–ù–∏–∫–æ–ª–∞–π –ö—Ä–µ–º–µ–Ω—Å–∫–∏</option>
      <option value="–ü–µ—Ç—ä—Ä –•—Ä–∏—Å—Ç–æ–≤">–ü–µ—Ç—ä—Ä –•—Ä–∏—Å—Ç–æ–≤</option>
      <option value="–ü–ª–∞–º–µ–Ω –ò–≤–∞–Ω–æ–≤">–ü–ª–∞–º–µ–Ω –ò–≤–∞–Ω–æ–≤</option>
      <option value="–¢–∏—Ö–æ–º–∏—Ä –¢–æ–¥–æ—Ä–æ–≤">–¢–∏—Ö–æ–º–∏—Ä –¢–æ–¥–æ—Ä–æ–≤</option>
      <option value="–¢–æ–Ω–∏ –î–µ–Ω–µ–≤">–¢–æ–Ω–∏ –î–µ–Ω–µ–≤</option>
      <option value="–¶–≤–µ—Ç–æ–º–∏—Ä –ò–≤–∞–Ω–æ–≤">–¶–≤–µ—Ç–æ–º–∏—Ä –ò–≤–∞–Ω–æ–≤</option>
      <option value="–¶–≤–µ—Ç–æ–º–∏—Ä –¶–æ–Ω–µ–≤">–¶–≤–µ—Ç–æ–º–∏—Ä –¶–æ–Ω–µ–≤</option>
      </select>
    </label>
    <label>–û—Ç:
      <select id="fromCountry">
        <option value="–ê–≤—Å—Ç—Ä–∏—è">–ê–≤—Å—Ç—Ä–∏—è</option>
        <option value="–ë–µ–ª–≥–∏—è">–ë–µ–ª–≥–∏—è</option>
        <option value="–ë—ä–ª–≥–∞—Ä–∏—è">–ë—ä–ª–≥–∞—Ä–∏—è</option>
        <option value="–•—ä—Ä–≤–∞—Ç–∏—è">–•—ä—Ä–≤–∞—Ç–∏—è</option>
        <option value="–ß–µ—Ö–∏—è">–ß–µ—Ö–∏—è</option>
        <option value="–î–∞–Ω–∏—è">–î–∞–Ω–∏—è</option>
        <option value="–ï—Å—Ç–æ–Ω–∏—è">–ï—Å—Ç–æ–Ω–∏—è</option>
        <option value="–§–∏–Ω–ª–∞–Ω–¥–∏—è">–§–∏–Ω–ª–∞–Ω–¥–∏—è</option>
        <option value="–§—Ä–∞–Ω—Ü–∏—è">–§—Ä–∞–Ω—Ü–∏—è</option>
        <option value="–ì–µ—Ä–º–∞–Ω–∏—è">–ì–µ—Ä–º–∞–Ω–∏—è</option>
        <option value="–ì—ä—Ä—Ü–∏—è">–ì—ä—Ä—Ü–∏—è</option>
        <option value="–£–Ω–≥–∞—Ä–∏—è">–£–Ω–≥–∞—Ä–∏—è</option>
        <option value="–ò—Ç–∞–ª–∏—è">–ò—Ç–∞–ª–∏—è</option>
        <option value="–õ–∞—Ç–≤–∏—è">–õ–∞—Ç–≤–∏—è</option>
        <option value="–õ–∏—Ç–≤–∞">–õ–∏—Ç–≤–∞</option>
        <option value="–ù–∏–¥–µ—Ä–ª–∞–Ω–¥–∏—è">–ù–∏–¥–µ—Ä–ª–∞–Ω–¥–∏—è</option>
        <option value="–ù–æ—Ä–≤–µ–≥–∏—è">–ù–æ—Ä–≤–µ–≥–∏—è</option>
        <option value="–ü–æ–ª—à–∞">–ü–æ–ª—à–∞</option>
        <option value="–ü–æ—Ä—Ç—É–≥–∞–ª–∏—è">–ü–æ—Ä—Ç—É–≥–∞–ª–∏—è</option>
        <option value="–†—É–º—ä–Ω–∏—è">–†—É–º—ä–Ω–∏—è</option>
        <option value="–°–ª–æ–≤–∞–∫–∏—è">–°–ª–æ–≤–∞–∫–∏—è</option>
        <option value="–°–ª–æ–≤–µ–Ω–∏—è">–°–ª–æ–≤–µ–Ω–∏—è</option>
        <option value="–ò—Å–ø–∞–Ω–∏—è">–ò—Å–ø–∞–Ω–∏—è</option>
        <option value="–®–≤–µ—Ü–∏—è">–®–≤–µ—Ü–∏—è</option>
        <option value="–®–≤–µ–π—Ü–∞—Ä–∏—è">–®–≤–µ–π—Ü–∞—Ä–∏—è</option>
        <option value="–¢—É—Ä—Ü–∏—è">–¢—É—Ä—Ü–∏—è</option>

      </select>
    </label>
    <label>–ó–∞:
      <select id="toCountry">
        <option value="–ê–≤—Å—Ç—Ä–∏—è">–ê–≤—Å—Ç—Ä–∏—è</option>
        <option value="–ë–µ–ª–≥–∏—è">–ë–µ–ª–≥–∏—è</option>
        <option value="–ë—ä–ª–≥–∞—Ä–∏—è">–ë—ä–ª–≥–∞—Ä–∏—è</option>
        <option value="–•—ä—Ä–≤–∞—Ç–∏—è">–•—ä—Ä–≤–∞—Ç–∏—è</option>
        <option value="–ß–µ—Ö–∏—è">–ß–µ—Ö–∏—è</option>
        <option value="–î–∞–Ω–∏—è">–î–∞–Ω–∏—è</option>
        <option value="–ï—Å—Ç–æ–Ω–∏—è">–ï—Å—Ç–æ–Ω–∏—è</option>
        <option value="–§–∏–Ω–ª–∞–Ω–¥–∏—è">–§–∏–Ω–ª–∞–Ω–¥–∏—è</option>
        <option value="–§—Ä–∞–Ω—Ü–∏—è">–§—Ä–∞–Ω—Ü–∏—è</option>
        <option value="–ì–µ—Ä–º–∞–Ω–∏—è">–ì–µ—Ä–º–∞–Ω–∏—è</option>
        <option value="–ì—ä—Ä—Ü–∏—è">–ì—ä—Ä—Ü–∏—è</option>
        <option value="–£–Ω–≥–∞—Ä–∏—è">–£–Ω–≥–∞—Ä–∏—è</option>
        <option value="–ò—Ç–∞–ª–∏—è">–ò—Ç–∞–ª–∏—è</option>
        <option value="–õ–∞—Ç–≤–∏—è">–õ–∞—Ç–≤–∏—è</option>
        <option value="–õ–∏—Ç–≤–∞">–õ–∏—Ç–≤–∞</option>
        <option value="–ù–∏–¥–µ—Ä–ª–∞–Ω–¥–∏—è">–ù–∏–¥–µ—Ä–ª–∞–Ω–¥–∏—è</option>
        <option value="–ù–æ—Ä–≤–µ–≥–∏—è">–ù–æ—Ä–≤–µ–≥–∏—è</option>
        <option value="–ü–æ–ª—à–∞">–ü–æ–ª—à–∞</option>
        <option value="–ü–æ—Ä—Ç—É–≥–∞–ª–∏—è">–ü–æ—Ä—Ç—É–≥–∞–ª–∏—è</option>
        <option value="–†—É–º—ä–Ω–∏—è">–†—É–º—ä–Ω–∏—è</option>
        <option value="–°–ª–æ–≤–∞–∫–∏—è">–°–ª–æ–≤–∞–∫–∏—è</option>
        <option value="–°–ª–æ–≤–µ–Ω–∏—è">–°–ª–æ–≤–µ–Ω–∏—è</option>
        <option value="–ò—Å–ø–∞–Ω–∏—è">–ò—Å–ø–∞–Ω–∏—è</option>
        <option value="–®–≤–µ—Ü–∏—è">–®–≤–µ—Ü–∏—è</option>
        <option value="–®–≤–µ–π—Ü–∞—Ä–∏—è">–®–≤–µ–π—Ü–∞—Ä–∏—è</option>
        <option value="–¢—É—Ä—Ü–∏—è">–¢—É—Ä—Ü–∏—è</option>
      </select>
    </label>
    <label>–ù–∞—á–∞–ª–Ω–∞ –¥–∞—Ç–∞: <input type="date" id="startDate"></label>
    <label>–ö—Ä–∞–π–Ω–∞ –¥–∞—Ç–∞: <input type="date" id="endDate"></label>
    <div class="overlay-form-buttons">
      <button onclick="saveOverlay()">–∑–∞–ø–∞–∑–∏</button>
      <button onclick="closeOverlay()">–æ—Ç–º–µ–Ω–∏</button>
    </div>
  </div>

  <button id="clearWeekBtn" onclick="clearCurrentWeek()">üßπ</button>
  <button id="downloadReportBtn" onclick="downloadReport()">üñ®Ô∏è</button>

  <script>
    let today = new Date();
    let dayOfWeek = today.getDay();
    let diffToMonday = dayOfWeek === 0 ? -6 : 1 - dayOfWeek;
    let currentWeekStart = new Date(today);
    currentWeekStart.setDate(today.getDate() + diffToMonday);
    currentWeekStart.setHours(0, 0, 0, 0);
  
    let activeCell = null;
    let scheduledTasks = [];
    let driverStatuses = {};
    let longPauses = {};
  
    async function loadDataFromServer() {
      try {
        const res = await fetch('/api/load');
        const data = await res.json();
        scheduledTasks = data.tasks || [];
        driverStatuses = data.statuses || {};
        longPauses = data.longPauses || {};
        updateCalendar();
      } catch (e) {
        console.error("Failed to load data from server:", e);
      }
    }
  
    async function saveDataToServer() {
      try {
        await fetch('/api/save', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            tasks: scheduledTasks,
            statuses: driverStatuses,
            longPauses: longPauses
          })
        });
      } catch (e) {
        console.error("Failed to save data to server:", e);
      }
    }
  
    function parseDateFromInput(dateStr) {
      const [year, month, day] = dateStr.split("-").map(Number);
      return new Date(year, month - 1, day);
    }
  
    function isDriverInLongPause(driver) {
      const pause = longPauses[driver];
      if (!pause) return false;
      const now = new Date();
      return now < new Date(pause);
    }
  
    function updateCalendar() {
      const options = { weekday: 'long', month: 'long', day: 'numeric' };
      for (let i = 0; i < 7; i++) {
        let date = new Date(currentWeekStart);
        date.setDate(currentWeekStart.getDate() + i);
        document.getElementById(`day${i + 1}`).innerText = date.toLocaleDateString('bg-BG', options);
      }
  
      const allCells = Array.from(document.querySelectorAll(".truck-cell:not(.fixed)"));
      allCells.forEach(cell => cell.innerHTML = "");
  
      const currentDrivers = new Set();
  
      for (let task of scheduledTasks) {
        const start = parseDateFromInput(task.startDate);
        const end = parseDateFromInput(task.endDate);
  
        let d = new Date(start);
        d.setHours(0, 0, 0, 0);
  
        while (d <= end) {
          const offset = Math.round((d - currentWeekStart) / (1000 * 60 * 60 * 24));
          if (offset >= 0 && offset < 7) {
            const cellIndex = task.truckRow * 7 + offset;
            const cell = allCells[cellIndex];
            if (cell) {
              cell.innerHTML = `
                <div class="entry-box country-${task.from}" data-task-id="${task.id}">
                  ${task.driver}<br>${task.from} ‚Üí ${task.to}
                  <div class="entry-controls">
                    <button onclick="openOverlay(this.closest('.truck-cell'))">‚úèÔ∏è</button>
                    <button onclick="removeTask('${task.id}')">‚ùå</button>
                  </div>
                </div>`;
            }
            currentDrivers.add(task.driver);
          }
          d.setDate(d.getDate() + 1);
        }
      }
  
      for (let driver in driverStatuses) {
        if (driverStatuses[driver] === "driving" && !currentDrivers.has(driver)) {
          driverStatuses[driver] = "available";
        }
      }
  
      document.querySelectorAll('.driver').forEach(driver => {
        const name = driver.textContent.trim();
        driver.classList.remove("driver-status-available", "driver-status-driving", "driver-status-break");
        driver.style.opacity = "1";
  
        if (isDriverInLongPause(name)) {
          driver.classList.add("driver-status-break");
          driver.style.opacity = "0.4";
          driver.title = "–ù–∞ –¥—ä–ª–≥–∞ –ø–∞—É–∑–∞ –¥–æ " + new Date(longPauses[name]).toLocaleString('bg-BG');
        } else {
          const status = driverStatuses[name];
          if (status === "break") {
            driver.classList.add("driver-status-break");
          } else if (currentDrivers.has(name)) {
            driver.classList.add("driver-status-driving");
          } else {
            driver.classList.add("driver-status-available");
          }
          driver.removeAttribute("title");
        }
      });
  
      saveDataToServer();
    }
  
    function openOverlay(cell) {
      if (cell.classList.contains('fixed')) return;
      activeCell = cell;
      document.getElementById('infoForm').style.display = 'block';
    }
  
    function closeOverlay() {
      document.getElementById('infoForm').style.display = 'none';
      activeCell = null;
    }
  
    function saveOverlay() {
      if (!activeCell) return;
      const driver = document.getElementById('driverSelect').value;
      if (isDriverInLongPause(driver)) {
        alert("–¢–æ–∑–∏ –≤–æ–¥–∞—á –µ –≤ 45-—á–∞—Å–æ–≤–∞ –ø–∞—É–∑–∞.");
        return;
      }
  
      const from = document.getElementById('fromCountry').value;
      const to = document.getElementById('toCountry').value;
      const startInput = document.getElementById('startDate').value;
      const endInput = document.getElementById('endDate').value;
      if (!startInput || !endInput) return;
  
      const index = Array.from(document.querySelectorAll(".truck-cell:not(.fixed)")).indexOf(activeCell);
      const row = Math.floor(index / 7);
  
      const taskId = `task-${Date.now()}-${Math.floor(Math.random() * 1000)}`;
      scheduledTasks.push({
        id: taskId,
        driver, from, to,
        startDate: startInput,
        endDate: endInput,
        truckRow: row
      });
  
      closeOverlay();
      updateCalendar();
    }
  
    function removeTask(id) {
      if (!confirm("–°–∏–≥—É—Ä–Ω–∏ –ª–∏ —Å—Ç–µ, —á–µ –∏—Å–∫–∞—Ç–µ –¥–∞ –∏–∑—Ç—Ä–∏–µ—Ç–µ —Ç–æ–∑–∏ –∫—É—Ä—Å?")) return;
      scheduledTasks = scheduledTasks.filter(t => t.id !== id);
      updateCalendar();
    }
  
    function clearCurrentWeek() {
      if (!confirm("–ù–∞–∏—Å—Ç–∏–Ω–∞ –ª–∏ –∏—Å–∫–∞—Ç–µ –¥–∞ –∏–∑—Ç—Ä–∏–µ—Ç–µ –≤—Å–∏—á–∫–æ –∑–∞ —Å–µ–¥–º–∏—Ü–∞—Ç–∞?")) return;
      const weekStart = new Date(currentWeekStart);
      const weekEnd = new Date(currentWeekStart);
      weekEnd.setDate(weekEnd.getDate() + 6);
  
      scheduledTasks = scheduledTasks.filter(task => {
        const start = parseDateFromInput(task.startDate);
        const end = parseDateFromInput(task.endDate);
        return end < weekStart || start > weekEnd;
      });
  
      updateCalendar();
    }
  
    function openDriverEditor() {
      document.getElementById("driverEditor").style.display = "block";
    }
  
    function closeDriverEditor() {
      document.getElementById("driverEditor").style.display = "none";
    }
  
    function saveDriverStatus() {
      const name = document.getElementById("driverSelectEdit").value;
      const status = document.getElementById("driverStatusSelect").value;
  
      if (status === "longpause") {
        const pauseStartInput = document.getElementById("longPauseStart");
        if (pauseStartInput && pauseStartInput.value) {
          const startTime = new Date(pauseStartInput.value);
          const pauseUntil = new Date(startTime.getTime() + 45 * 60 * 60 * 1000);
          longPauses[name] = pauseUntil.toISOString();
        } else {
          alert("–ú–æ–ª—è, –≤—ä–≤–µ–¥–µ—Ç–µ –Ω–∞—á–∞–ª–æ—Ç–æ –Ω–∞ 45-—á–∞—Å–æ–≤–∞—Ç–∞ –ø–∞—É–∑–∞.");
          return;
        }
      } else {
        delete longPauses[name];
      }
  
      driverStatuses[name] = status;
      closeDriverEditor();
      updateCalendar();
    }
  
    function prevWeek() {
      currentWeekStart.setDate(currentWeekStart.getDate() - 7);
      updateCalendar();
    }
  
    function nextWeek() {
      currentWeekStart.setDate(currentWeekStart.getDate() + 7);
      updateCalendar();
    }
  
    function downloadReport() {
      let reportWindow = window.open("", "Report", "width=800,height=600");
      reportWindow.document.write("<html><head><title>–°–µ–¥–º–∏—á–µ–Ω –æ—Ç—á–µ—Ç</title>");
      reportWindow.document.write("<style>body { font-family: Arial; padding: 20px; }</style>");
      reportWindow.document.write("</head><body>");
      reportWindow.document.write(`<h2>–°–µ–¥–º–∏—á–µ–Ω –æ—Ç—á–µ—Ç (${currentWeekStart.toLocaleDateString('bg-BG')})</h2>`);
  
      if (scheduledTasks.length === 0) {
        reportWindow.document.write("<p>–ù—è–º–∞ –ø—Ä–µ–¥–≤–∏–¥–µ–Ω–∏ –∏/–∏–ª–∏ –∏–∑–ø—ä–ª–Ω–µ–Ω–∏ –∫—É—Ä—Å–æ–≤–µ –∑–∞ —Ç–∞–∑–∏ —Å–µ–¥–º–∏—Ü–∞.</p>");
      } else {
        reportWindow.document.write("<ul>");
        for (let task of scheduledTasks) {
          const start = parseDateFromInput(task.startDate);
          const end = parseDateFromInput(task.endDate);
          const startStr = start.toLocaleDateString('bg-BG');
          const endStr = end.toLocaleDateString('bg-BG');
          reportWindow.document.write(
            `<li><strong>${task.driver}</strong>: ${task.from} ‚Üí ${task.to} (${startStr} –¥–æ ${endStr})</li>`
          );
        }
        reportWindow.document.write("</ul>");
      }
  
      reportWindow.document.write("</body></html>");
      reportWindow.document.close();
      reportWindow.print();
    }
  
    document.getElementById("driverStatusSelect").addEventListener("change", function () {
      const longPauseGroup = document.getElementById("longPauseStartGroup");
      if (this.value === "longpause") {
        longPauseGroup.style.display = "block";
      } else {
        longPauseGroup.style.display = "none";
      }
    });
  
    loadDataFromServer();
  </script>
  
</body>
</html>
  
